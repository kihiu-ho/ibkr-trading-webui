# IBKR Trading WebUI Configuration Template
# Copy this file to .env and update with your actual values

# ========================================
# IBKR Configuration
# ========================================
IBKR_ACCOUNT_ID=DU1234567
IBKR_USERNAME=your_ibkr_username
IBKR_PASSWORD=your_ibkr_password
IBKR_API_BASE_URL=https://127.0.0.1:5055/v1/api
IBKR_SSL_VERIFY=false
IBKR_HOST=ibkr-gateway        # Hostname of the IBKR Client Portal Gateway (use 127.0.0.1 outside Docker)
IBKR_PORT=4002                # 4002 = paper trading, 4001 = live trading

# ========================================
# Database Configuration (PostgreSQL)
# ========================================
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=ibkr_trading
DATABASE_URL=postgresql+psycopg://postgres:postgres@localhost:5432/ibkr_trading

# ========================================
# Redis Configuration (Celery broker & cache)
# ========================================
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# ========================================
# MinIO / S3 Object Storage
# ========================================
MINIO_ENDPOINT=localhost:9000
MINIO_PUBLIC_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=trading-charts
MINIO_SECURE=false

# ========================================
# LLM / AI Configuration for Trading Signals
# ========================================

# LLM Provider: Choose "openai", "gemini", or "ollama"
LLM_VISION_PROVIDER=openai

# ----------------
# OpenAI Configuration (Recommended for best quality)
# ----------------
# Get your API key from: https://platform.openai.com/api-keys
# Cost: ~$0.01-0.03 per chart analysis (~$1-3 per 100 signals)
# Models available: gpt-4-vision-preview, gpt-4-turbo, gpt-4o
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_API_BASE=https://api.openai.com/v1
OPENAI_MODEL=gpt-4-turbo-preview
LLM_VISION_MODEL=gpt-4-vision-preview

# ----------------
# Google Gemini Configuration (FREE alternative!)
# ----------------
# Get your API key from: https://aistudio.google.com/app/apikey
# Cost: FREE for up to 1500 requests/day
# Models available: gemini-2.0-flash-exp, gemini-pro-vision
# Recommended for development and testing!
#
# To use Gemini, uncomment these lines and comment out OpenAI:
# LLM_VISION_PROVIDER=gemini
# LLM_VISION_MODEL=gemini-2.0-flash-exp
# GEMINI_API_KEY=your_gemini_api_key_here
# GEMINI_API_BASE=https://generativelanguage.googleapis.com/v1beta

# ----------------
# Ollama / Local LLM (Advanced - requires setup)
# ----------------
# For local LLM with vision support (e.g., LLaVA, Llama with vision)
# Requires: Ollama installed and running locally
# Cost: FREE (runs on your hardware)
# Setup: https://ollama.ai
# LLM_VISION_PROVIDER=ollama
# LLM_VISION_MODEL=llava:13b
# OLLAMA_API_BASE=http://host.docker.internal:11434

# ----------------
# LLM Request Settings
# ----------------
LLM_VISION_MAX_TOKENS=4096        # Maximum response length
LLM_VISION_TEMPERATURE=0.1        # Lower = more consistent (0.0-2.0)
LLM_VISION_TIMEOUT=60             # Request timeout in seconds
AI_REQUEST_TIMEOUT=120

# ----------------
# LLM Feature Flags
# ----------------
LLM_CONSOLIDATE_TIMEFRAMES=true   # Consolidate daily+weekly analysis
LLM_RETRY_ATTEMPTS=3              # Retry failed requests
LLM_RETRY_DELAY=2                 # Delay between retries (seconds)

# ========================================
# Application Settings
# ========================================
APP_NAME=IBKR Trading WebApp
VERSION=1.0.0
DEBUG=true
ENVIRONMENT=development
IBKR_STRICT_MODE=false           # true enforces real IBKR connectivity (auto-enabled outside dev/test)
SECRET_KEY=change-this-secret-key-in-production
BACKEND_PORT=8000
API_V1_PREFIX=/api/v1

# ========================================
# Trading Settings
# ========================================
AUTO_TRADING_ENABLED=false        # Enable automatic order placement
PAPER_TRADING_MODE=true           # Use paper trading (safe mode)
WORKFLOW_DELAY_SECONDS=60         # Delay between workflow executions
DEFAULT_TIF=DAY                   # Time in force: DAY, GTC, IOC, FOK
DEFAULT_ORDER_TYPE=LMT            # Order type: LMT, MKT, STP, etc.

# ========================================
# Risk Management
# ========================================
MIN_R_COEFFICIENT=1.0             # Minimum R-multiple for trades
MIN_PROFIT_MARGIN=0.05            # Minimum profit margin (5%)
RISK_PER_TRADE=0.01               # Risk 1% per trade
MAX_PORTFOLIO_EXPOSURE=0.90       # Max 90% portfolio exposure
MAX_OPEN_POSITIONS=10             # Maximum concurrent positions
MAX_POSITION_SIZE=0.20            # Max 20% per position

# ========================================
# Chart Configuration
# ========================================
CHART_WIDTH=1920                  # Chart image width (pixels)
CHART_HEIGHT=1080                 # Chart image height (pixels)
CHART_CACHE_TTL=3600              # Chart cache time-to-live (seconds)

# ========================================
# Feature Flags
# ========================================
ENABLE_SIGNAL_GENERATION=true     # Enable LLM signal generation
ENABLE_ANALYSIS_CACHE=true        # Cache analysis results
ENABLE_CHART_CACHE=true           # Cache generated charts

# ========================================
# QUICK START GUIDE
# ========================================
# 1. Copy this file: cp .env.example .env
# 2. Choose your LLM provider (OpenAI or Gemini recommended)
# 3. Get an API key:
#    - OpenAI: https://platform.openai.com/api-keys
#    - Gemini: https://aistudio.google.com/app/apikey
# 4. Update OPENAI_API_KEY or GEMINI_API_KEY above
# 5. Restart services: docker-compose restart backend celery-worker
# 6. Test at: http://localhost:8000/signals.html
