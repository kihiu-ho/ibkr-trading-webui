-- Create sample stock data table and insert test data for TSLA and NVDA

-- Create stock_data table if it doesn't exist
CREATE TABLE IF NOT EXISTS stock_data (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL,
    date DATE NOT NULL,
    open DECIMAL(10, 2) NOT NULL,
    high DECIMAL(10, 2) NOT NULL,
    low DECIMAL(10, 2) NOT NULL,
    close DECIMAL(10, 2) NOT NULL,
    volume BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(symbol, date)
);

-- Insert sample TSLA data (last 30 days)
INSERT INTO stock_data (symbol, date, open, high, low, close, volume) VALUES
('TSLA', '2025-10-05', 245.50, 251.30, 243.20, 249.80, 95234567),
('TSLA', '2025-10-06', 249.90, 253.40, 248.10, 251.60, 88456123),
('TSLA', '2025-10-07', 251.70, 256.80, 250.30, 255.20, 102345678),
('TSLA', '2025-10-08', 255.30, 258.90, 253.40, 257.10, 96789012),
('TSLA', '2025-10-09', 257.20, 260.40, 255.80, 259.30, 89012345),
('TSLA', '2025-10-10', 259.40, 262.10, 258.20, 260.90, 85678901),
('TSLA', '2025-10-13', 260.90, 264.20, 259.50, 262.80, 91234567),
('TSLA', '2025-10-14', 262.90, 265.40, 261.30, 263.70, 87890123),
('TSLA', '2025-10-15', 263.80, 267.20, 262.40, 265.90, 93456789),
('TSLA', '2025-10-16', 265.90, 268.50, 264.30, 267.20, 88901234),
('TSLA', '2025-10-17', 267.30, 270.80, 266.10, 269.50, 95567890),
('TSLA', '2025-10-20', 269.60, 272.40, 268.20, 271.10, 90123456),
('TSLA', '2025-10-21', 271.20, 274.90, 269.80, 273.40, 92789012),
('TSLA', '2025-10-22', 273.50, 276.20, 272.10, 275.60, 89345678),
('TSLA', '2025-10-23', 275.70, 278.90, 274.30, 277.20, 94901234),
('TSLA', '2025-10-24', 277.30, 280.50, 276.10, 279.80, 97567890),
('TSLA', '2025-10-27', 279.90, 282.40, 278.50, 281.20, 91123456),
('TSLA', '2025-10-28', 281.30, 284.60, 280.10, 283.90, 93789012),
('TSLA', '2025-10-29', 284.00, 287.20, 282.80, 285.50, 96345678),
('TSLA', '2025-10-30', 285.60, 288.90, 284.20, 287.30, 98901234),
('TSLA', '2025-10-31', 287.40, 290.10, 286.00, 288.70, 95567890),
('TSLA', '2025-11-03', 288.80, 291.50, 287.30, 290.20, 94123456),
('TSLA', '2025-11-04', 290.30, 293.80, 289.10, 292.50, 99789012)
ON CONFLICT (symbol, date) DO UPDATE SET
    open = EXCLUDED.open,
    high = EXCLUDED.high,
    low = EXCLUDED.low,
    close = EXCLUDED.close,
    volume = EXCLUDED.volume;

-- Insert sample NVDA data (last 30 days)
INSERT INTO stock_data (symbol, date, open, high, low, close, volume) VALUES
('NVDA', '2025-10-05', 485.20, 492.30, 482.10, 489.50, 45123456),
('NVDA', '2025-10-06', 489.60, 495.80, 487.30, 493.20, 48789012),
('NVDA', '2025-10-07', 493.30, 498.70, 491.40, 496.80, 52345678),
('NVDA', '2025-10-08', 496.90, 502.40, 494.50, 500.10, 49901234),
('NVDA', '2025-10-09', 500.20, 505.60, 498.30, 503.40, 47567890),
('NVDA', '2025-10-10', 503.50, 508.20, 501.10, 506.70, 46123456),
('NVDA', '2025-10-13', 506.80, 511.90, 504.50, 509.30, 50789012),
('NVDA', '2025-10-14', 509.40, 514.60, 507.20, 512.50, 48345678),
('NVDA', '2025-10-15', 512.60, 517.80, 510.30, 515.90, 51901234),
('NVDA', '2025-10-16', 515.90, 520.40, 513.60, 518.20, 49567890),
('NVDA', '2025-10-17', 518.30, 523.70, 516.10, 521.50, 53123456),
('NVDA', '2025-10-20', 521.60, 526.20, 519.30, 524.80, 50789012),
('NVDA', '2025-10-21', 524.90, 529.60, 522.70, 527.40, 52345678),
('NVDA', '2025-10-22', 527.50, 532.10, 525.20, 530.60, 48901234),
('NVDA', '2025-10-23', 530.70, 535.90, 528.40, 533.20, 54567890),
('NVDA', '2025-10-24', 533.30, 538.50, 531.10, 536.80, 51123456),
('NVDA', '2025-10-27', 536.90, 541.30, 534.60, 539.50, 49789012),
('NVDA', '2025-10-28', 539.60, 544.80, 537.30, 542.90, 53345678),
('NVDA', '2025-10-29', 542.90, 547.40, 540.60, 545.70, 55901234),
('NVDA', '2025-10-30', 545.80, 550.20, 543.50, 548.30, 52567890),
('NVDA', '2025-10-31', 548.40, 553.10, 546.20, 551.60, 51123456),
('NVDA', '2025-11-03', 551.70, 556.50, 549.40, 554.80, 54789012),
('NVDA', '2025-11-04', 554.90, 559.30, 552.60, 557.50, 56345678)
ON CONFLICT (symbol, date) DO UPDATE SET
    open = EXCLUDED.open,
    high = EXCLUDED.high,
    low = EXCLUDED.low,
    close = EXCLUDED.close,
    volume = EXCLUDED.volume;

-- Verify data was inserted
SELECT symbol, COUNT(*) as record_count, MIN(date) as earliest_date, MAX(date) as latest_date
FROM stock_data
WHERE symbol IN ('TSLA', 'NVDA')
GROUP BY symbol
ORDER BY symbol;

